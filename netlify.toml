[build]
command = """
export BINDGEN_EXTRA_CLANG_ARGS="--sysroot=`emconfigure env 2> /dev/null | sed -n -e 's/^EMSCRIPTEN=//p'`/cache/sysroot" && \
cargo +nightly build -vv --bin typebeat-dot-xyz --features netlify --target wasm32-unknown-emscripten --release && \
npx vite build www/typebeat.xyz
"""
publish = "www/typebeat.xyz/dist"

[build.environment]
EMMAKEN_CFLAGS = """
--embed-file assets/samples \
-gsource-map \
-s ALLOW_MEMORY_GROWTH=1 \
-s ENVIRONMENT=web \
-s ERROR_ON_UNDEFINED_SYMBOLS=0 \
-s EXPORTED_RUNTIME_METHODS=\"['ccall','_free','UTF8ToString']\" \
-s EXPORT_ES6=1 \
-s MODULARIZE=1
"""

[[redirects]]
from = "https://typebeat.netlify.app/*"
to = "https://typebeat.xyz/:splat"
