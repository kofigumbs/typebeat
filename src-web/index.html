<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
  <title>Typebeat</title>
  <link rel="icon" type="image/svg+xml" href="/icon.svg">

  <script type="module">
    import init from 'typebeat-ui/index.js';
    import wasm from '../target/wasm32-unknown-emscripten/release/typebeat_web.wasm?url';

    // This is probably a bug with emscripten. Seems like it's missing a `var`
    // before using miniaudio. I don't understand it well enough to report tho.
    globalThis.miniaudio = undefined;

    import('../target/wasm32-unknown-emscripten/release/typebeat-web.js').then(async factory => {
      const lib = await factory.default({ locateFile: () => wasm, noExitRuntime: true });
      const start = () => {
        document.querySelector('.info').remove();
        document.body.classList.add('mount');
        const controller = lib.ccall('start', 'number', [], []);
        init((context, { method, data }) => {
          switch (context) {
            case 'get': return lib.ccall('get', 'number', ['number', 'string'], [controller, method]);
            case 'set': return lib.ccall('set', 'number', ['number', 'string', 'number'], [controller, method, data]);
          }
        });
      };
      document.querySelector('.start').addEventListener('click', start, { once: true });
    });
  </script>

  <style>
.info {
  padding-top: 15vw;
  padding-left: 15vw;
  padding-right: 15vw;
  margin: 0 auto;
  max-width: 40rem;
}
.logo {
  max-width: 200px;
}
  </style>
</head>

<div class="info">
  <p>Typebeat is a musical instrument played with your QWERTY keyboard.</p>
  <p>
    <a class="start" href="javascript:void(0)">Try it online</a> (with latency) or
    <a href="https://github.com/kofigumbs/typebeat">run it on your computer</a>.
  </p>
</div>
