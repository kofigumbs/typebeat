<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
  <title>Typebeat</title>

  <script type="module">
    import run from 'typebeat-ui/index.js';
    import wasmUrl from '../target/wasm32-unknown-emscripten/release/typebeat_web.wasm?url';

    import('../target/wasm32-unknown-emscripten/release/typebeat-web.js').then(async factory => {
      const lib = await factory.default({ locateFile: () => wasmUrl, noExitRuntime: true });
      const init = () => {
        const controller = lib.ccall('start', 'number', [], []);
        run((context, { method, data }) => {
          switch (context) {
            case 'get': return lib.ccall('get', 'number', ['number', 'string'], [controller, method]);
            case 'set': return lib.ccall('set', 'number', ['number', 'string', 'number'], [controller, method, data]);
          }
        });
        document.querySelector('.mount').classList.add('ready');
      };
      document.querySelector('.start').addEventListener('click', init, { once: true });
    });
  </script>

  <style>
.mount:not(.ready) {
  display: none;
}
.mount.ready + .info {
  display: none;
}
.info {
  padding-top: 15vw;
  padding-left: 15vw;
  padding-right: 15vw;
  max-width: 40rem;
}
.logo {
  max-width: 200px;
}
  </style>
</head>

<div class="mount"></div>
<div class="info">
  <img class="logo" src="../static/logo/screenshot.png" alt="Typebeat.">
  <p>A music toy played with your QWERTY keyboard.</p>
  <p>
    <a class="start" href="javascript:void(0)">Try it online</a> (with latency) or
    <a href="https://github.com/kofigumbs/typebeat">run it on your computer</a>.
  </p>
</div>
